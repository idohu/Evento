<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Manager | Evento</title>

    <!-- core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/prettyPhoto.css" rel="stylesheet">
    <link href="css/animate.min.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    <link href="css/responsive.css" rel="stylesheet">

    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->
    <link rel="shortcut icon" href="images/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="images/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="images/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="images/ico/apple-touch-icon-57-precomposed.png">
</head>
<!--/head-->

<body>

    <header id="header">
        <div class="top-bar">
            <div class="container">
                <div class="row">
                    <div class="col-sm-6 col-xs-4">
                        <div class="top-number">
                            <p><i class="fa fa-phone-square"></i>+0123 456 70 90</p>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xs-8">
                        <div class="social">
                            <ul class="social-share">
                                <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                                <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                                <li><a href="#"><i class="fa fa-linkedin"></i></a></li>
                                <li><a href="#"><i class="fa fa-dribbble"></i></a></li>
                                <li><a href="#"><i class="fa fa-skype"></i></a></li>
                            </ul>
                            <div class="search">
                                <form role="form">
                                    <input type="text" class="search-form" autocomplete="off" placeholder="Search">
                                    <i class="fa fa-search"></i>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--/.container-->
        </div>
        <!--/.top-bar-->

        <nav class="navbar navbar-inverse" role="banner">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="index.html">
                        <img src="images/logo.png" alt="logo"></a>
                </div>

                <div class="collapse navbar-collapse navbar-right">
                    <ul class="nav navbar-nav" id="navbarPlace">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="about-us.html">About Us</a></li>
                        <li class="active"><a href="manager-home.html">Managers</a></li>
                        <li><a href="user-home.html">Users</a></li>
                        <li><a href="contact-us.html">Contact</a></li>
                        
                    </ul>
                </div>
            </div>
            <!--/.container-->
        </nav>
        <!--/nav-->

    </header>
    <!--/header-->
    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Event Details</h4>
                </div>
                <div class="modal-body" id="eventModalBody">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createNewEvent()">Confirm</button>
                </div>
            </div>
        </div>
    </div>
    <section id="feature" class="transparent-bg">
        <div class="container">
            <div class="center wow fadeInDown">
                <h2>Our Services</h2>
                <p class="lead">
                    We Provide a newer and better platform for participating in events and event managment<br>
                    from anywhere using whatever device you own
                </p>
            </div>

            <div class="row">
                <div class="features">
                    <div class="col-lg-6">
                        <h2>Previos Events</h2>
                        <div class="accordion">
                            <div class="panel-group" id="accordionPrev">
                                
                            </div>
                            <!--/#accordion1-->
                        </div>
                    </div>
                    <!--/.col-md-4-->

                    <div class="col-lg-6">
                        <h2>Upcoming Events</h2>
                        <div class="accordion">
                            <div class="panel-group" id="accordionUp">
                                
                            </div>
                            <!--/#accordion1-->
                        </div>
                    </div>
                    <!--/.col-md-4-->
                </div>
                <!--/.services-->
            </div>
            <!--/.row-->
            <br />
            <div class="center wow fadeInDown">
                <h2>Create New Event</h2>
                <div class="row">
                    <div class="col-lg-6">
                        <label>Event Title </label>
                        <input type="text" id="title" class="form-control">
                        <label>Event Time </label>
                        <input type="time" id="timepicker" class="form-control" />
                        <label>Event Date </label>
                        <input type="date" id="date" class="form-control">
                        <label>Event Type </label>
                        <input type="text" id="type" class="form-control">
                        <label>Main Artist </label>
                        <input type="text" id="artist" class="form-control">
                        <input type="hidden" value="0" id="typeValue" />
                        <button onclick="addElement();" class="btn" style="margin:5px;">Add tickets</button>
                        <div id="ticketDiv">
						<label style="margin:5px;">Type</label><label>Amount</label><label style="margin:5px;" >Price</label></div>
                    </div>
                    <div class="col-lg-6">
                        <label>Event Description </label>
                        <textarea cols="50" rows="6" id="description" class="form-control"></textarea>
                        <label>Event Location </label>
                        <input type="text" id="location" class="form-control">
                        <div id="mapPlacer" style="width: 500px; height: 380px;"></div>
                        
                    </div>
                </div>
                <div class="center">
                    <br />
                    <button type="button" class="btn btn-success" onclick="newEvent()">Create Event</button>
                </div>
            </div>
            <div class="clients-area center wow fadeInDown">
                <h2>What People Are Saying</h2>
                <p class="lead">
                    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut
                    <br>
                    et dolore magna aliqua. Ut enim ad minim veniam
                </p>
            </div>

            <div class="row">
                <div class="col-md-4 wow fadeInDown">
                    <div class="clients-comments text-center">
                        <img src="images/client1.png" class="img-circle" alt="">
                        <h3>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt</h3>
                        <h4><span>-John Doe /</span>  Director of corlate.com</h4>
                    </div>
                </div>
                <div class="col-md-4 wow fadeInDown">
                    <div class="clients-comments text-center">
                        <img src="images/client2.png" class="img-circle" alt="">
                        <h3>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt</h3>
                        <h4><span>-John Doe /</span>  Director of corlate.com</h4>
                    </div>
                </div>
                <div class="col-md-4 wow fadeInDown">
                    <div class="clients-comments text-center">
                        <img src="images/client3.png" class="img-circle" alt="">
                        <h3>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt</h3>
                        <h4><span>-John Doe /</span>  Director of corlate.com</h4>
                    </div>
                </div>
            </div>

        </div>
        <!--/.container-->
    </section>
    <!--/#feature-->

    <footer id="footer" class="midnight-blue">
        <div class="container">
            <div class="row">
                <div class="col-sm-6">
                    &copy; 2013 <a target="_blank" href="http://shapebootstrap.net/" title="Free Twitter Bootstrap WordPress Themes and HTML templates">ShapeBootstrap</a>. All Rights Reserved.
               
                </div>
                <div class="col-sm-6">
                    <ul class="pull-right">
                        <li><a href="#">Home</a></li>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Faq</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>
    <!--/#footer-->

    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.prettyPhoto.js"></script>
    <script src="js/jquery.isotope.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/wow.min.js"></script>
    <script type="text/javascript">
            var user = getCookie("EventoManagerUsername");
            var pass = getCookie("EventoManagerPassword");
            if (user == "") {
                window.location.href = "manager-enter.html";
            }
			else{
			var x = '<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">'+user+'<i class="fa fa-angle-down"></i></a>'+
                            '<ul class="dropdown-menu"><li><a href="#">Profile</a></li><li><a onclick="SignOut()">Sign Out</a></li></ul></li>';
			document.getElementById("navbarPlace").innerHTML += x;
			}
    </script>
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript">
        Date.prototype.yyyymmdd = function () {
            var yyyy = this.getFullYear().toString();
            var mm = (this.getMonth() + 1).toString();
            var dd = this.getDate().toString();
            return yyyy + "-" + (mm[1] ? mm : "0" + mm[0]) + "-" + (dd[1] ? dd : "0" + dd[0]);
        };
        Date.prototype.HHMM = function () {
            var hh = this.getHours().toString();
            var mm = this.getMinutes().toString();
            return (hh[1] ? hh : "0" + hh[0]) + ":" + (mm[1] ? mm : "0" + mm[0]);
        }
        $(document).ready(function () {
            var d = new Date(Date.now());
            document.getElementById("date").value = d.yyyymmdd();
            document.getElementById("timepicker").value = d.HHMM();
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(GetAddress);
            }

        });
        var marker;
        function GetAddress(position) {
            var myLatlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
            var mapOptions = {
                zoom: 15,
                center: myLatlng
            }
            var map = new google.maps.Map(document.getElementById("mapPlacer"), mapOptions);

            // Place a draggable marker on the map
            marker = new google.maps.Marker({
                position: myLatlng,
                map: map,
                draggable: true
            });
            var geocoder = new google.maps.Geocoder();
            geocoder.geocode({ 'latLng': marker.position }, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    if (results[0]) {
                        document.getElementById("location").value = results[0].formatted_address;
                    }
                }
            });
            google.maps.event.addListener(marker, 'dragend', function (evt) {
                geocoder.geocode({ 'latLng': marker.position }, function (results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        if (results[0]) {
                            document.getElementById("location").value = results[0].formatted_address;
                        }
                    }
                });
            });
        }

        var user = getCookie("EventoManagerUsername");
        $.ajax({
            type: "POST",
            url: "http://hdm.ise.bgu.ac.il/EventoServices/Evento.asmx/GetEventsForManager",
            data: "{\"managerName\":\"" + user + "\"}",
            crossDomain: true,
            contentType: "application/json; charset=UTF-8",
            accepts: "application/json",
            dataType: "json",
            async: false,
            success: function (data, textStatus, jqXHR) {
                var events = JSON.parse(data.d);
				var n =1;
                events.forEach(function(entry) {
                    var d = new Date(entry.Time);
					var x = '<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">' +
                            '<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion1" href="#collapse'+n+'">' +entry.EventName +
                            '<i class="fa fa-angle-right pull-right"></i></a></h3></div><div id="collapse' + n + '" class="panel-collapse collapse"><div class="panel-body">' +
                            entry.Description + '<br /><a href="manager-event.html?eventId=' + entry.Id + '">Go To Event</a></div></div></div>';
                    if (d>Date.now()) {//upcoming
                        document.getElementById("accordionUp").innerHTML += x;
                    }
                    else//previos
                    {
                        document.getElementById("accordionPrev").innerHTML += x;

                    }
					n++;
                });

            },
            error: function (jq, textStatus, errorThrown) {
                alert(' errors : ' + errorThrown + ' ' + textStatus + ' ' + jq.responseText + ' ' + jq.statusText);
            }
        });
        function newEvent() {
            var ancestor = document.getElementById('ticketDiv'),
            descendents = ancestor.getElementsByTagName('*');
            var i, e, d = "", total = 0;
            for (i = 0; i < descendents.length; ++i) {
                e = descendents[i];
                if (e.id.substring(0, 4) == "type") {
                    d += e.value + " - " + descendents[i + 1].value + "<br/>";
                    total += parseInt(descendents[i + 1].value);
                }

            }
            var x = "" + document.getElementById("title").value + "<br/>";
            x += "will be held at " + document.getElementById("location").value + " on " + document.getElementById("date").value + " " + document.getElementById("timepicker").value + "<br/>";
            x += document.getElementById("description").value;
            document.getElementById("eventModalBody").innerHTML = x;
            $('#myModal').modal();
        }

        function createNewEvent() {
            var info = "{\"eventName\":\"" + document.getElementById("title").value + "\"," +
                "\"description\":\"" + document.getElementById("description").value + "\"," +
                "\"location\":\"" + marker.position + "\"," +
                "\"time\":\"" + document.getElementById("date").value + " " + document.getElementById("timepicker").value + "\"," +
                "\"artist\":\"" + document.getElementById("artist").value + "\"," +
                "\"eventManager\":\"" + "Zappa Manager" + "\"," +
                "\"eventType\":\"" + document.getElementById("type").value + "\"," +
                "\"image\":\"" + "TestImage.jpg" + "\"" +
                "}";
            $.ajax({
                type: "POST",
                url: "http://hdm.ise.bgu.ac.il/EventoServices/Evento.asmx/CreateEvent",
                data: info,
                crossDomain: true,
                contentType: "application/json; charset=UTF-8",
                accepts: "application/json",
                dataType: "json",
                async: false,
                success: function (data, textStatus, jqXHR) {
                    if (data.d != "") {
                        var len = parseInt(document.getElementById('typeValue').value);
                        var eventId = parseInt(data.d);
						var f = true;
                        for (var i = 1; i <= len; i++) {
                            var x = "{\"eventId\":\"" + eventId + "\"," +
                                "\"type\":\"" + document.getElementById("type"+i).value + "\"," +
                                "\"amount\":\"" + parseInt(document.getElementById("amount" + i).value) + "\"," +
                                "\"price\":\"" + parseFloat(document.getElementById("price" + i).value) + "\"" +
                                "}";
                            $.ajax({
                                type: "POST",
                                url: "http://hdm.ise.bgu.ac.il/EventoServices/Evento.asmx/AddTicketsToEvent",
                                data: x,
                                crossDomain: true,
                                contentType: "application/json; charset=UTF-8",
                                accepts: "application/json",
                                dataType: "json",
                                async: false,
                                success: function (data, textStatus, jqXHR) {
                                },
                                error: function (jq, textStatus, errorThrown) {
								f=false;
                                    alert(' errors : ' + errorThrown + ' ' + textStatus + ' ' + jq.responseText + ' ' + jq.statusText);
                                }
                            });
                        }
						if (f)
                        window.location.href = "manager-event.html?eventid=" + data.d;
                    }

                },
                error: function (jq, textStatus, errorThrown) {
                    alert(' errors : ' + errorThrown + ' ' + textStatus + ' ' + jq.responseText + ' ' + jq.statusText);
                }
            });
        }

        function addElement() {
            var ni = document.getElementById('ticketDiv');
            var numi = document.getElementById('typeValue');
            var num = (document.getElementById('typeValue').value - 1) + 2;
            numi.value = num;
            var newdiv = document.createElement('div');
            var divIdName = 'my' + num + 'Div';
            newdiv.setAttribute('id', divIdName);
            newdiv.innerHTML = '<input type="text"  style="margin:5px;" id="type' + num + '"/><input  type="number" min="0" id="amount' + num + '"/><input style="margin:5px;" type="number"  step="0.1" min="0" id="price' + num + '"/><button onclick=\'removeElement("' + divIdName + '")\'>-</button>';
            ni.appendChild(newdiv);
        }

        function removeElement(divNum) {
            var d = document.getElementById('ticketDiv');
            var olddiv = document.getElementById(divNum);
            d.removeChild(olddiv);
        }
		function SignOut(){
			deleteCookie("EventoManagerUsername");
			deleteCookie("EventoManagerPassword");
			window.location.href = "index.html";
		}
    </script>

</body>
</html>
